<html>
<head>
    <link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css">

    <script src="/components/jquery/dist/jquery.min.js"></script>
    <script src="/components/d3/d3.min.js"></script>
    <script src="/components/radial-progress-chart/dist/radial-progress-chart.min.js"></script>
    <script src="/components/bootstrap/dist/js/bootstrap.min.js"></script>

    <style type="text/css">
        .cpu-board {

        }

        .gauge {
            width: 110px;
            height: 110px;
            text-align: center;
            float: left;
            margin-right: 5px;
        }

        .gauge .rbc-center-text-line0 {
            font-size: 30px;
        }
    </style>

    <script type="text/javascript">
        $(function () {
            var cpu = new RadialProgressChart('#cpu', {
                stroke: {
                    width: 20,
                    gap: 2
                },
                shadow: {
                    width: 0
                },
                max: 100,
                round: false,
                series: [{
                    value: 0,
                    color: ['green', 'red']
                }],
                center: function (d) {
                    return d.toFixed(0) + '%'
                }
            });

            var memory = new RadialProgressChart('#memory', {
                stroke: {
                    width: 20,
                    gap: 2
                },
                shadow: {
                    width: 0
                },
                max: 100,
                round: false,
                series: [{
                    value: 0,
                    color: ['green', 'red']
                }],
                center: function (d) {
                    return d.toFixed(0) + '%'
                }
            });

            var swap = new RadialProgressChart('#swap', {
                stroke: {
                    width: 20,
                    gap: 2
                },
                shadow: {
                    width: 0
                },
                max: 100,
                round: false,
                series: [{
                    value: 0,
                    color: ['green', 'red']
                }],
                center: function (d) {
                    return d.toFixed(0) + '%'
                }
            });

            function refreshInfo() {
                $.ajax({
                    url: '{{ path('smalot_vagrant_rest_machine_info') }}',
                    success: function (result) {
                        var usage = 0;

                        for (i in result.cpu) {
                            usage += result.cpu[i].usage;
                        }
                        cpu.update(usage / result.cpu.length);

                        memory.update(result.memory.used / result.memory.total * 100);
                        if (result.swap.total) {
                            usage = result.swap.used / result.swap.total * 100;
                        } else {
                            usage = 0;
                        }

                        swap.update(usage);
                    }
                });

                setTimeout(refreshInfo, 2000);
            }

            setTimeout(refreshInfo, 2000);
        });
    </script>
</head>
<body>
<h1>Dashboard</h1>
<div class="board">
    <div id="cpu" class="gauge">CPU</div>
    <div id="memory" class="gauge">Memory</div>
    <div id="swap" class="gauge">Swap</div>
</div>
</body>
</html>
